<% @posts.each do |post| %>
    <article class="media">
        <figure class="media-left">
            <a href="<%= user_path(post.user) %>">
                <p class="image is-64x64">
                    <% if post.user.profile_picture.attached? %>
                        <%= image_tag(post.user.profile_picture.variant(resize_to_fill: [64, 64]), class: "is-rounded") %>
                    <% else %>
                        <img src="https://bulma.io/images/placeholders/64x64.png" class="is-rounded">
                    <% end %>
                </p>
            </a>
        </figure>
        <div class="media-content">
            <div class="content">
                <% if current_user.id != post.user.id && !current_user.friends.include?(post.user) %>
                    <a href="<%= friend_requests_path(friend_request: { receiving_user_id: post.user.id, sending_user_id: current_user.id }) %>" data-method="post">
                        <span class="icon"><i class="fas fa-user-plus"></i></span>
                    </a>
                <% end %>

                <% if current_user.id != post.user.id && current_user.friends.include?(post.user) %>
                    <span class="icon"><i class="fas fa-user-friends"></i></span>
                <% end %>

                <a href="<%= user_path(post.user) %>">
                    <strong><%= post.user.full_name %></strong>
                </a>
                <small><%= distance_of_time_in_words(Time.now, post.created_at) %> ago</small>
                </p>
                <p><%= post.body %></p>
            </div>
            <nav class="level is-mobile">
                <div class="level-left">
                    <% if current_user.id != post.user_id %>
                        <% if current_user.liked_posts.any? { |liked_post| liked_post.id == post.id } %>
                            <a href="<%= like_path(Like.find_by(user_id: current_user.id, post_id: post.id)) %>" data-method="delete" class="level-item">
                            <span class="icon"><i class="fas fa-heart is-danger"></i></span>
                            </a>
                        <% else %>
                            <a href="<%= likes_path(like: { user_id: current_user.id, post_id: post.id }) %>" data-method="post" class="level-item">
                            <span class="icon"><i class="far fa-heart"></i></span>
                            </a>
                        <% end %>
                    <% end %>
                    
                    <% if user_signed_in? && current_user.id == post.user_id %>
                        <a href="<%= edit_post_path(post) %>" class="level-item">
                        <span class="icon"><i class="far fa-edit"></i></span>
                        </a>
                        <a href="<%= post_path(post) %>" class="level-item" data-method="delete" data-confirm="Are you sure you want to delete this post?">
                        <span class="icon has-text-danger"><i class="far fa-trash-alt"></i></span>
                        </a>
                    <% end %>
                </div>
            </nav>

            <%= render partial: "comments/form", locals: { post_id: post.id } %>
            <br>

            <% if post.comments.any? %>
                <% post.comments.each do |comment| %>
                    <article class="media">
                        <figure class="media-left">
                            <a href="<%= user_path(comment.creator) %>">
                                <p class="image is-64x64">
                                    <% if comment.user.profile_picture.attached? %>
                                        <%= image_tag(comment.user.profile_picture.variant(resize_to_fill: [64, 64]), class: "is-rounded") %>
                                    <% else %>
                                        <img src="https://bulma.io/images/placeholders/64x64.png" class="is-rounded">
                                    <% end %>
                                </p>
                            </a>
                        </figure>
                        <div class="media-content">
                            <div class="content">
                                <p>
                                    <a href="<%= user_path(comment.creator) %>">
                                        <strong><%= comment.creator.full_name %></strong>
                                    </a>
                                    <small><%= distance_of_time_in_words(Time.now, comment.created_at)%> ago</small>
                                    <br>
                                    <%= comment.body %>
                                    <br>
                                </p>
                            </div>
                        </div>
                    </article>
                <% end %>
            <% end %>
    </article>  
<% end %>
