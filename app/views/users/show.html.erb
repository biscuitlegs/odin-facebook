<div class="modal" id="delete-account-modal">
    <div class="modal-background" id="delete-account-modal-background"></div>
    <div class="modal-card">
        <header class="modal-card-head has-background-danger">
            <strong class="modal-card-title has-text-centered has-text-white">Delete Account</strong>
            <button class="delete" id="delete-account-modal-close" aria-label="close"></button>
        </header>
        <section class="modal-card-body">
        <p class="mb-4">
        Deleting your account means that not only will you be <span class="has-text-danger">unable to sign in with your current details</span>, but also your:
        </p>
        <ul>
            <li>Posts</li>
            <li>Comments</li>
            <li>Friends List</li>
            <li>and Likes</li>
        </ul>
        <p class="mt-4">
        will be <span class="has-text-danger">permanently deleted</span>.
        </p>

        <hr>
        <strong>Are you sure you want to proceed and delete your account?
            <span class="has-text-danger bold">This action is irreversable!</span>
        </strong>
        </section>
        <footer class="modal-card-foot">
            <a href="<%= user_registration_path %>" class="button is-danger" data-method="delete" data-confirm="Are you sure you want to delete your account? This is your final warning!">
                <span class="icon is-small">
                    <i class="fas fa-trash-alt"></i>
                </span>
                <span>Delete my Account</span>
            </a>
        </footer>
    </div>
</div>


<section>
    <div class="columns">
        <div class="column mt-6">
            <div class="container box has-text-centered">
                <p class="title">Friends</p>

                <% if @user.friends.none? %>
                    <p>Looks like you don't have any friends yet...</p>
                    <br>
                    <a href="<%= users_path %>" class="button is-link">Let's fix that!</a>
                <% end %>

                <% @user.friends.each do |friend| %>
                    <a href="<%= user_path(friend.id) %>">
                        <div class="columns is-mobile is-centered">
                            <div class="column is-narrow">
                                <figure class="image is-64x64 level-item">
                                    <%= image_tag friend.primary_profile_picture, class: "is-rounded" %>
                                </figure>
                            </div>
                        </div>

                        <p class="mb-4"><%= friend.full_name %></p>
                    </a>
                <% end %>
            </div>
        </div>

        <div class="column">
            <div class="container box mt-6">
                <% if current_user.id == @user.id %>
                    <p class="title has-text-centered mb-6">My Profile</p>
                <% else %>
                    <p class="title has-text-centered mb-6"><%= @user.full_name %>'s Profile</p>
                <% end %>

                <!-- For Profile Picture Centering -->
                <div class="columns is-mobile is-centered">
                    <div class="column is-narrow">
                        <div class="container">
                            <% if @user.facebook_profile_picture %>
                                <figure class="image is-128x128">
                                    <img src="<%= @user.facebook_profile_picture %>" alt="profile picture" class="is-rounded">
                                </figure>
                            <% elsif @user.profile_picture.attached? %>
                                <figure class="image is-128x128">
                                    <%= image_tag(@user.profile_picture.variant(resize_to_fill: [128, 128]), class: "is-rounded") %>
                                </figure>
                            <% else %>
                                <figure class="image is-128x128">
                                    <img class="is-rounded" src="https://bulma.io/images/placeholders/128x128.png">
                                </figure>
                            <% end %>
                        </div>
                    </div>
                </div>

                <p class="has-text-centered is-size-5"><strong><%= @user.full_name %></strong></p>
                <p class="has-text-centered"><%= @user.email %></p>

                <% if @user.provider == "facebook" %>
                    <div class="columns is-mobile is-centered">
                        <div class="column is-narrow">
                            <span class="tag is-info is-centered">
                                <span class="icon">
                                    <i class="fab fa-facebook-square"></i>
                                </span>
                                <span>Linked with Facebook</span>
                            </span>
                        </div>
                    </div>
                    
                <% end %>

                <% if current_user.provider != "facebook" && current_user.id == @user.id %>
                    <%= render "users/form" %>
                <% end %>

                <% if current_user.provider == "facebook" && current_user.id == @user.id %>
                    <div class="notification">
                        <p>Whenever you update your Facebook profile, any changes will automatically carry over to your profile here.</p>
                    </div>
                <% end %>

                <% if @user.id == current_user.id %>
                    <div class="columns is-mobile is-centered">
                        <div class="column is-narrow">
                            <a class="button is-danger is-small" id="delete-account-modal-open-button">
                                <span class="icon is-small">
                                    <i class="fas fa-trash-alt"></i>
                                </span>
                                <span>Delete my Account</span>
                            </a>
                        </div>
                    </div>
                <% end %>

            </div>
        </div>

        <div class="column mt-6">
            <div class="container has-text-centered">
                <div class="box">
                    <div class="title">Posts</div>

                    <% if @user.posts.none? %>
                        <p>Need some inspiration for a post?</p>
                        <br>
                        <a href="<%= posts_path %>" class="button is-link">Let's go!</a>
                    <% end %>

                    <% @user.posts.each do |post| %>
                        <div class="box">
                            <p class="subtitle"><%= post.body %></p>
                            <strong><%= distance_of_time_in_words(Time.now, post.created_at) %> ago.</strong>
                        </div>
                    <% end %>

                </div>
            </div>
            
        </div>
    </div> 
</section>

<%= javascript_pack_tag 'delete_account' %>
